# Расчет коэффиента асимметрии лица на основе видеозаписи
## Методы и инструменты
В качестве данных для расчета коэффициента асимметрии использовались видеозаписи лица, на которых испытуемый выполнял следующие мимическе упражнения:
- Поднятие бровей,
- Зажмуривание левого глаза,
- Зажмуривание правого глаза,
- Зажмуривание обоих глаз,
- Улыбка,
- Улыбка с усилием,
- Надувание щек,
- Сжатие губ в трубочку,
- Артикуляция,
- Артикуляция с усилием.

Перед выполнением алгоритма расчета коэффициентов упражнения на видео размечаюются с помощью разработанного приложения, код которого находится в папке application 

## Алгоритм
Из видеозаписи выделяются отдельные изображения кадров. С помощью библиотеки [mediapipe face fesh]([http://dlib.net/](https://github.com/google-ai-edge/mediapipe/blob/master/docs/solutions/face_mesh.md)) на изображении лица выделяются ключевые точки верхней и нижней части лица.

![image](https://github.com/oodlbee/paresis_detection/assets/113666071/f2e94ae1-11ce-4976-aff6-661e26cff078)

Далее на основе выделенных точек вычисляются геометрические центры левого и правого глаза, а также центры левой и правой брови. На основе вычислинных центорв считюатся расстояния между средними точками глаз и бровей. 
Данные рассчеты выполняеются для состояния покоя и во время выполнения упражнения. Далее значения усредняются и высчитывается коэффициент асиметрии относительно состояния покоя.

## Графическое приложение
Основное окно содержит поля ввода директорий для видеофайла, файла разметки и директории сохранения результата работы алгоритма. Также содержит кнопку для открытия окна разметки видеофайла и кнопку для запуска алгоритма расчета коэффициентов асимметрии.

![image](https://github.com/oodlbee/paresis_detection/assets/113666071/2bf4a916-9a0a-431b-b346-b1cf8738ab94)

Окно разметки видеофайла содержит рамку с видеопотоком, ползунок прокрутки, кнопки паузы, перемотки на кадр вперед и назад, выпадающий список с упражнениями, кнопки разметки кадров начала и конца упражнений, кнопку для сохранения файла разметки.

![image](https://github.com/oodlbee/paresis_detection/assets/113666071/a10aace3-3bdc-41ab-96c4-71541a5d9798)

Также данное окно содержит меню в верхней панели, гдеможно выбрать функции очистки текущей разметки, очистки всей разметки ифункцию открытия окна редактирования списка упражнений.

![image](https://github.com/oodlbee/paresis_detection/assets/113666071/35be4fbf-3924-47f4-b1ff-cac3f33cea92)

Окно редактирования списка упражнений (Рисунок 4) представлено в виде интерфейса со списком упражнений, где пользователь имеет возможность добавлять новые упражнения, удалять или редактировать существующие.
При этом процесс добавления и редактирования упражнений проверяется согласно правилам синтаксиса Python: допускаются только латинские буквы без пробельных символов, а также символы нижнего подчеркивания. 
В данном окне реализовано оповещение пользователя о несохраненных изменениях при попытке закрытия окна.

![image](https://github.com/oodlbee/paresis_detection/assets/113666071/6c93297c-bf51-4d35-81a0-d58d5fa36b45)

Окно запуска алгоритма расчета коэффициента асимметрии открывается в отдельном процессе для обеспечения параллельного выполнения расчетов.

![image](https://github.com/oodlbee/paresis_detection/assets/113666071/1d21781b-3466-4df7-8712-e57a6009f888)

## Установка программы
Данная версия программы работает только на Windows. В ходе работы над кодом использовался Python 3.10.11
1. Клонирование репозитория
```shell
git clone https://github.com/oodlbee/paresis_detection.git
```
2. Установка бибилотек из папки репозитория
```shell
pip install -r requirements.txt
```
3. Далее необходимо распаковать файл ffmpeg.7z в папку проекта
